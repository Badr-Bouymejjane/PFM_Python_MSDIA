{% extends 'base.html' %}

{% block title %}üìö Tous les cours - Course Recommender{% endblock %}

{% block content %}
<section class="page-section">
    <h1 class="section-title"><i data-lucide="book-open"></i> Catalogue de cours</h1>
    <p class="text-muted">Explorez notre catalogue de {{ total }} cours disponibles sur Coursera et Udemy.</p>
</section>

<!-- Compact Filters Bar -->
<div class="search-filter-box">
    <form class="search-compact" method="GET" action="{{ url_for('courses') }}">
        <i data-lucide="search" size="18"></i>
        <input type="text" name="search" placeholder="Rechercher par titre ou mot-cl√©..." value="{{ current_filters.search or '' }}">
        
        <!-- Hidden inputs to preserve other filters -->
        <input type="hidden" name="platform" value="{{ current_filters.platform or '' }}">
        <input type="hidden" name="category" value="{{ current_filters.category or '' }}">
        <input type="hidden" name="level" value="{{ current_filters.level or '' }}">
        <input type="hidden" name="sort" value="{{ current_filters.sort or 'rating' }}">
        
        <button type="submit" class="btn-search">Filtrer</button>
    </form>
    
    <div class="filters-compact">
        <select onchange="window.location.href=this.value" class="filter-pill">
            <option value="{{ url_for('courses', **dict(current_filters, platform='')) }}">Plateforme</option>
            {% for p in platforms %}
            <option value="{{ url_for('courses', **dict(current_filters, platform=p)) }}" {% if current_filters.platform == p %}selected{% endif %}>{{ p }}</option>
            {% endfor %}
        </select>
        <select onchange="window.location.href=this.value" class="filter-pill">
            <option value="{{ url_for('courses', **dict(current_filters, category='')) }}">Cat√©gorie</option>
            {% for c in categories %}
            <option value="{{ url_for('courses', **dict(current_filters, category=c)) }}" {% if current_filters.category == c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
        <select onchange="window.location.href=this.value" class="filter-pill">
            <option value="{{ url_for('courses', **dict(current_filters, level='')) }}">Niveau</option>
            {% for l in levels %}
            <option value="{{ url_for('courses', **dict(current_filters, level=l)) }}" {% if current_filters.level == l %}selected{% endif %}>{{ l }}</option>
            {% endfor %}
        </select>
        <select onchange="window.location.href=this.value" class="filter-pill" style="min-width: 180px;">
            <option value="{{ url_for('courses', **dict(current_filters, sort='recommendation')) }}" {% if current_filters.sort == 'recommendation' %}selected{% endif %}>Tri: Recommand√©</option>
            <option value="{{ url_for('courses', **dict(current_filters, sort='rating')) }}" {% if current_filters.sort == 'rating' %}selected{% endif %}>Tri: Note (Haut)</option>
            <option value="{{ url_for('courses', **dict(current_filters, sort='title')) }}" {% if current_filters.sort == 'title' %}selected{% endif %}>Tri: Alphab√©tique</option>
        </select>
    </div>
    
    <a href="{{ url_for('courses') }}" class="btn-search" style="background:#64748b; text-decoration:none;">Reset</a>
</div>

<section class="page-section">
    <div class="results-header" style="margin-bottom: 2.5rem;">
        <h2 class="section-title"><i data-lucide="bar-chart-2"></i> Catalogue Complet</h2>
        <span class="results-count">{{ total }} cours | Page {{ current_page }} / {{ pages }}</span>
    </div>
    
    <div class="courses-grid">
        {% for course in courses %}
        <div class="course-card" onclick="window.location.href='{{ url_for('course_detail', course_id=course.course_id) }}'">
            {% if course.platform | lower == 'coursera' %}
            <img src="{{ url_for('static', filename='imgs/coursera-logo.png') }}" class="course-logo" alt="Coursera">
            {% elif course.platform | lower == 'udemy' %}
            <img src="{{ url_for('static', filename='imgs/logo-udemy.svg') }}" class="course-logo" alt="Udemy">
            {% else %}
            <div class="course-platform {{ course.platform | lower }}">{{ course.platform }}</div>
            {% endif %}
            
            <h3 class="course-title">{{ course.title }}</h3>
            <p class="course-instructor"><i data-lucide="user" size="14"></i> {{ course.instructor or 'N/A' }}</p>
            
            {% if course.similarity_score and current_filters.sort == 'recommendation' %}
            <div class="similarity-bar-wrapper" style="margin-bottom: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                    <span style="font-size: 0.75rem; font-weight: 700; color: var(--primary); text-transform: uppercase; letter-spacing: 0.05em;">Pertinence</span>
                    <span style="font-size: 0.85rem; font-weight: 800; color: var(--primary);">{{ course.similarity_score }}%</span>
                </div>
                <div class="similarity-bar-container" style="margin-bottom: 0;">
                    <div class="similarity-bar">
                        <div class="similarity-fill" style="width: {{ course.similarity_score }}%"></div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <div class="course-meta">
                <span class="meta-badge rating"><i data-lucide="star" size="12"></i> {{ "%.1f" | format(course.rating or 0) }}</span>
                <span class="meta-badge level"><i data-lucide="trending-up" size="12"></i> {{ course.level or 'Tout niveau' }}</span>
                <span class="meta-badge category"><i data-lucide="tag" size="12"></i> {{ course.category }}</span>
                {% if course.price %}
                <span class="meta-badge price" style="background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2);">
                    <i data-lucide="credit-card" size="12"></i> {{ course.price }}
                </span>
                {% endif %}
            </div>
            <div class="course-footer">
                <span class="course-link">D√©tails ‚Üí</span>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if pages > 1 %}
    <div class="pagination" style="display:flex; justify-content:center; align-items:center; gap:1rem; margin-top:3rem; padding-top:2rem; border-top:1px solid var(--border-light);">
        {% if current_page > 1 %}
        <a href="{{ url_for('courses', page=current_page-1, **current_filters) }}" class="btn-search" style="padding: 0.6rem 1.2rem; background: var(--bg-secondary); color: var(--text-primary);">Pr√©c√©dent</a>
        {% endif %}
        
        <span style="font-weight: 600;">Page {{ current_page }} / {{ pages }}</span>
        
        {% if current_page < pages %}
        <a href="{{ url_for('courses', page=current_page+1, **current_filters) }}" class="btn-search" style="padding: 0.6rem 1.2rem;">Suivant</a>
        {% endif %}
    </div>
    {% endif %}
</section>
{% endblock %}
